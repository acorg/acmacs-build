#! /bin/bash

TAG=$(cat "${ACMACSD_ROOT}/share/tag")
PACKAGES_FILE=$(python3 -c "import os; print(os.path.dirname(os.path.realpath(\"$0\")) + '/../packages.$TAG')")

trap "{ echo FAILED >&2; exit 1; }" ERR

if command -v gmake >/dev/null 2>&1; then MAKE=gmake; else MAKE=make; fi

for package in $(cat "${PACKAGES_FILE}"); do
    ${MAKE} -C "${ACMACSD_ROOT}/sources/${package}" clean
done
