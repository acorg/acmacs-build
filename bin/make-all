#! /bin/bash

NPROC=$(if [ "$(uname -s)" = "Darwin" ]; then /usr/sbin/sysctl -n hw.logicalcpu; else /usr/bin/nproc; fi)
TAG=$(cat "${ACMACSD_ROOT}/share/tag")
PACKAGES_FILE=$(python3 -c "import os; print(os.path.dirname(os.path.realpath(\"$0\")) + '/../packages.$TAG')")

for package in $(cat "${PACKAGES_FILE}"); do
    ( cd "${ACMACSD_ROOT}/sources/${package}" && make -j${NPROC} "$@" ) || exit 1
done
